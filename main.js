(()=>{"use strict";var e=document.querySelector(".profile__edit-button"),t=(document.querySelector(".popup__close"),document.querySelector(".popup__close-add"),document.querySelector(".popup__close_img"),document.querySelector(".profile__avatar")),n=document.querySelector(".profile__avatar-button"),r=document.querySelector(".elements"),o=document.querySelector(".profile__add-button"),i=document.querySelector(".popup-userProfile"),u=document.querySelector(".popup-add"),c=document.querySelector(".popup-avatar"),a=document.querySelector(".popup__submit-btn_edit"),s=document.querySelector(".popup__submit-btn_add"),l=document.querySelector(".popup__submit-btn_avatar"),f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-btn",inactiveButtonClass:"popup__submit-btn_inactive",inputErrorClass:"popup__input_type_error"};function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),h(this,"_openedClass","popup_is-opened"),h(this,"_closePopupOverlay",(function(e){e.target.classList.contains(n._openedClass)&&n.closePopup()})),h(this,"_handleEscClose",(function(e){"Escape"===e.key&&n._element.classList.contains(n._openedClass)&&n.closePopup()})),this._element=document.querySelector(t),this.closeBtn=this._element.querySelector(".popup__close"),this._handleCloseCallback=this.closePopup.bind(this)}var t,n;return t=e,(n=[{key:"openPopup",value:function(){this._element.classList.add(this._openedClass),this.setEventListeners()}},{key:"closePopup",value:function(){this._element.classList.remove(this._openedClass),this.removeEventListeners()}},{key:"setEventListeners",value:function(){this.closeBtn.addEventListener("click",this._handleCloseCallback),this._element.addEventListener("click",this._closePopupOverlay),document.addEventListener("keydown",this._handleEscClose)}},{key:"removeEventListeners",value:function(){this.closeBtn.removeEventListener("click",this._handleCloseCallback),this._element.removeEventListener("click",this._closePopupOverlay),document.removeEventListener("keydown",this._handleEscClose)}}])&&p(t.prototype,n),e}();function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t,n){return y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},y(e,t,n||e)}function v(e,t){return v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v(e,t)}function b(e,t){if(t&&("object"===_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return k(e)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=g(r);if(o){var n=g(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return b(this,e)});function u(e,t){var n,r=e.handleSubmitForm;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(n=i.call(this,t))._handleSubmitForm=r,n._formElement=n._element.querySelector(".popup__form"),n._submitFormCallback=n._submitForm.bind(k(n)),n._inputList=n._formElement.querySelectorAll(".popup__input"),n}return t=u,(n=[{key:"_getInputValues",value:function(){var e=this;return this._formValues={},this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"setInputValues",value:function(e){var t=this;this._getInputValues(),Object.assign(this._formValues,e),this._inputList.forEach((function(e){e.value=t._formValues[e.name]}))}},{key:"_submitForm",value:function(e){e.preventDefault(),this._handleSubmitForm(this._getInputValues())}},{key:"setEventListeners",value:function(){y(g(u.prototype),"setEventListeners",this).call(this),this._formElement.addEventListener("submit",this._submitFormCallback)}},{key:"removeEventListeners",value:function(){y(g(u.prototype),"removeEventListeners",this).call(this),this._formElement.removeEventListener("submit",this._submitFormCallback)}},{key:"closePopup",value:function(){y(g(u.prototype),"closePopup",this).call(this),this._formElement.reset()}}])&&d(t.prototype,n),u}(m);function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t,n){return w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=O(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},w(e,t,n||e)}function L(e,t){return L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},L(e,t)}function P(e,t){if(t&&("object"===S(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function O(e){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},O(e)}var j=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=O(r);if(o){var n=O(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return P(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._placeImg=t._element.querySelector(".popup__image"),t._placeName=t._element.querySelector(".popup__title_img"),t}return t=u,(n=[{key:"openPopup",value:function(e){this._placeImg.src=e.link,this._placeImg.alt=e.name,this._placeName.textContent=e.name,w(O(u.prototype),"openPopup",this).call(this)}}])&&C(t.prototype,n),u}(m);function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e,t,n){return B="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=D(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},B(e,t,n||e)}function R(e,t){return R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},R(e,t)}function T(e,t){if(t&&("object"===I(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return F(e)}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}var V=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=D(r);if(o){var n=D(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return T(this,e)});function u(e,t){var n,r=e.handleSubmitForm;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(n=i.call(this,t))._handleSubmitForm=r,n._formElement=n._element.querySelector(".popup__submit-btn_delete"),n._submitFormCallback=n._submitForm.bind(F(n)),n}return t=u,(n=[{key:"openPopup",value:function(e,t){B(D(u.prototype),"openPopup",this).call(this),this._cardID=e,this._card=t}},{key:"_submitForm",value:function(e){e.preventDefault(),this._handleSubmitForm(this._cardID),this.closePopup(),this._card.remove()}},{key:"setEventListeners",value:function(){B(D(u.prototype),"setEventListeners",this).call(this),this._formElement.addEventListener("click",this._submitFormCallback)}},{key:"removeEventListeners",value:function(){B(D(u.prototype),"removeEventListeners",this).call(this),this._formElement.removeEventListener("click",this._submitFormCallback)}}])&&q(t.prototype,n),u}(m);function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var N=function(){function e(t,n){var r=t.data,o=t.handleCardClick,i=t.handleDeleteClick,u=t.handleLike,c=t.userData;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=r.name,this.link=r.link,this._likes=r.likes,this._cardID=r._id,this._userCardName=r.owner.name,this._userName=c.name,this._cardSelector=n,this._handleCardClick=o,this._handleDeleteClick=i,this._handleLike=u,this._element=this._getElement(),this._likeButton=this._element.querySelector(".element__heart-button"),this._deleteButton=this._element.querySelector(".element__remove-button"),this._cardImage=this._element.querySelector(".element__image"),this._cardTitle=this._element.querySelector(".element__title"),this._cardLikes=this._element.querySelector(".element__likes-number"),this.handleLikeIcon=this.handleLikeIcon.bind(this),this._toggleLike=this._toggleLike.bind(this)}var t,n;return t=e,(n=[{key:"_getElement",value:function(){return document.querySelector(this._cardSelector).content.firstElementChild.cloneNode(!0)}},{key:"createCard",value:function(){return this._cardTitle.textContent=this.name,this._cardImage.alt=this.name,this._cardImage.src=this.link,this._cardLikes.textContent=this._likes.length,this._userCardName!=this._userName&&this._deleteButton.remove(),this._setEventListeners(),this._element}},{key:"handleLikeIcon",value:function(e){this._likeButton.classList.toggle("element__heart-button-active"),this._cardLikes.textContent=e.length}},{key:"_toggleLike",value:function(e){this._handleLike(e.target,this._cardID)}},{key:"removeCard",value:function(){this.closest(".element").remove()}},{key:"_setEventListeners",value:function(){this._likeButton.addEventListener("click",this._toggleLike.bind(this)),this._deleteButton.addEventListener("click",this._handleDeleteClick.bind(this)),this._cardImage.addEventListener("click",this._handleCardClick.bind(this))}}])&&x(t.prototype,n),e}();function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var z=function(){function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._items=r,this._renderer=o,this.container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"rendererItem",value:function(){var e=this;this._items.forEach((function(t){e._renderer(t)}))}},{key:"addItem",value:function(e){this.container.prepend(e)}}])&&U(t.prototype,n),e}();function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var W=function(){function e(t){var n=t.userNameSelector,r=t.userWorkSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._userNameElm=document.querySelector(n),this._userWorkElm=document.querySelector(r)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return this._userInfo={},this._userInfo.name=this._userNameElm.textContent,this._userInfo.about=this._userWorkElm.textContent,this._userInfo}},{key:"setUserInfo",value:function(e){this._userNameElm.textContent=e.name,this._userWorkElm.textContent=e.about}}])&&A(t.prototype,n),e}();function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var M=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),H(this,"_showInputError",(function(e,t){var n=r._targetFormElm.querySelector("#".concat(e.id,"-error"));e.classList.add(r._inputErrorClass),n.textContent=t})),H(this,"_hideInputError",(function(e){var t=r._targetFormElm.querySelector("#".concat(e.id,"-error"));e.classList.remove(r._inputErrorClass),t.textContent=""})),this._formSelector=t.formSelector,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._targetFormElm=n,this._inputList=Array.from(this._targetFormElm.querySelectorAll(this._inputSelector)),this._buttonElement=this._targetFormElm.querySelector(this._submitButtonSelector)}var t,n;return t=e,(n=[{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(e){return!e.validity.valid}))}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput(this._inputList)?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1)}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}},{key:"_setEventListeners",value:function(){var e=this;this._toggleButtonState(),this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState()}))}))}},{key:"enableValidation",value:function(){this._setEventListeners()}},{key:"resetValidation",value:function(){var e=this;this._toggleButtonState(),this._inputList.forEach((function(t){e._hideInputError(t)}))}}])&&J(t.prototype,n),e}();function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var K=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.token=n}var t,n;return t=e,(n=[{key:"getInitialCards",value:function(){return fetch(this.url+"/cards",{headers:{authorization:this.token}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.log(e),[]}))}},{key:"getUserData",value:function(){return fetch(this.url+"/users/me",{headers:{authorization:this.token}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.log(e),[]}))}},{key:"patchUserData",value:function(e){return fetch(this.url+"/users/me",{method:"PATCH",headers:{authorization:this.token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,about:e.about})}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.log(e),[]}))}},{key:"postCard",value:function(e){return fetch(this.url+"/cards",{method:"POST",headers:{authorization:this.token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.log(e),[]}))}},{key:"deleteCard",value:function(e){return fetch(this.url+"/cards/"+e,{method:"DELETE",headers:{authorization:this.token}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.log(e),[]}))}},{key:"putLikeCard",value:function(e){return fetch(this.url+"/cards/likes/"+e,{method:"PUT",headers:{authorization:this.token}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.log(e),[]}))}},{key:"deleteLikeCard",value:function(e){return fetch(this.url+"/cards/likes/"+e,{method:"DELETE",headers:{authorization:this.token}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.log(e),[]}))}},{key:"getCard",value:function(e){return fetch(this.url+"/cards/"+e,{headers:{authorization:this.token}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.log(e),[]}))}},{key:"patchAvatar",value:function(e){return fetch(this.url+"/users/me/avatar ",{method:"PATCH",headers:{authorization:this.token,"Content-Type":"application/json"},body:JSON.stringify({avatar:e.link})}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.log(e),[]}))}}])&&G(t.prototype,n),e}(),Q=new M(f,u);Q.enableValidation();var X=new M(f,i);X.enableValidation();var Y=new M({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-btn",inactiveButtonClass:"popup__submit-btn_inactive-avatar",inputErrorClass:"popup__input_type_error"},c);Y.enableValidation();var Z=new j(".popup_img"),$=new V({handleSubmitForm:function(e){oe.deleteCard(e).then().catch((function(e){return console.log(e),[]}))}},".popup_delete"),ee=new E({handleSubmitForm:function(e){ue(a,"Сохранение..."),ie.setUserInfo(e),oe.patchUserData(e).then().catch((function(e){return console.log(e),[]})),ue(a,"Сохранение"),ee.closePopup()}},".popup-userProfile"),te=new E({handleSubmitForm:function(e){ue(s,"Сохранение..."),oe.postCard(e).then((function(e){console.log(e);var t=re(e,ie.getUserInfo());r.prepend(t),ue(s,"Сохранение"),te.closePopup()})).catch((function(e){return console.log(e),[]}))}},".popup-add"),ne=new E({handleSubmitForm:function(e){ue(l,"Сохранение..."),oe.patchAvatar(e).then((function(n){t.src=e.link,ue(l,"Сохранение"),ne.closePopup()})).catch((function(e){return console.log(e),[]}))}},".popup-avatar");function re(e,t){var n=new N({data:e,handleCardClick:function(){return t=e,void Z.openPopup(t);var t},handleDeleteClick:function(){return function(e,t){var n=t.target.closest(".element");$.openPopup(e._id,n)}(e,event)},handleLike:function(e,t){e.classList.contains("element__heart-button-active")?oe.deleteLikeCard(t).then((function(e){n.handleLikeIcon(e.likes)})).catch((function(e){return console.log(e),[]})):oe.putLikeCard(t).then((function(e){n.handleLikeIcon(e.likes)})).catch((function(e){return console.log(e),[]}))},userData:t},"#element-template");return n.createCard()}var oe=new K("https://mesto.nomoreparties.co/v1/cohort-28","c9a5b46a-18cc-468c-aca5-c21309b709fb");oe.getInitialCards().then((function(e){var t=new z({items:e,renderer:function(e){var n=re(e,ie.getUserInfo());t.addItem(n)}},".elements");t.rendererItem()})).catch((function(e){return console.log(e),[]}));var ie=new W({userNameSelector:".profile__title",userWorkSelector:".profile__text"});function ue(e,t){e.textContent=t}oe.getUserData().then((function(e){ie.setUserInfo(e),t.src=e.avatar,t.alt=e.name})).catch((function(e){return console.log(e),[]})),e.addEventListener("click",(function(){ee.setInputValues(ie.getUserInfo()),X.resetValidation(),ee.openPopup()})),o.addEventListener("click",(function(){Q.resetValidation(),te.openPopup()})),n.addEventListener("click",(function(){Y.resetValidation(),ne.openPopup()}))})();